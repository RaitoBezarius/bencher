import BaseBranchCode from "../base-branch-code.mdx";

## Base Branch

A cornerstone of [Statistical Continuous Benchmarking][statistical continuous benchmarking]
is having a historical baseline for your base branch.
This historical baseline can then be used to detect performance regressions in Pull Requests.

<BaseBranchCode />

1. Create a GitHub Actions `workflow` file.
   (ex: `.github/workflows/base_benchmarks.yml`)
2. Run on `push` events to the `main` branch.
   See the [GitHub Actions `on` documentation][github actions on]
   and [GitHub Actions `push` documentation][github actions push] for a full overview.
   (ex: `on: push: branches: main`)
3. Create a GitHub Actions `job`.
   (ex: `jobs: benchmark_base_branch`)
4. Set the type of machine the job will run on.
   See the [GitHub Actions `runs-on` documentation][github actions runs-on]
   for a full overview.
   (ex: `runs-on: ubuntu-latest`)
5. Checkout your base branch source code.
   (ex: `uses: actions/checkout@v4`)
6. Install the Bencher CLI using [the GitHub Action][bencher cli github action].
   (ex: `uses: bencherdev/bencher@main`)
7. Use the <code><a href="/docs/explanation/bencher-run/">bencher run</a></code> CLI subcommand
   to run your `main` branch benchmarks.
   See [the `bencher run` CLI subcommand][bencher run] for a full overview.
   (ex: `bencher run`)
8. Set the `--project` option to the Project slug.
   See [the `--project` docs][project option] for more details.
   (ex: `--project save-walter-white-1234abcd`)
9. Set the `--token` option to the `BENCHER_API_TOKEN` **Repository** secret.
   See [the `--token` docs][token option] for more details.
   (ex: `--token '${{ secrets.BENCHER_API_TOKEN }}'`)
10. Set the `--branch` option to the base Branch name.
   See [the `--branch` docs][branch option] for a full overview.
   (ex: `--branch main`)
11. Set the `--testbed` option to the Testbed name.
    This should likely match the machine selected in `runs-on`.
    See [the `--tested` docs][testbed option] for more details.
    (ex: `--testbed ubuntu-latest`)
12. Set the Threshold for the `main` Branch, `ubuntu-latest` Testbed, and `latency` Measure:
    1. Set the `--threshold-measure` option to the built-in `latency` Measure that is generated by <code><a href="/docs/reference/bencher-metric-format/#bencher-mock">bencher mock</a></code>.
    See [the `--threshold-measure` docs][threshold measure option] for more details.
    (ex: `--threshold-measure latency`)
    2. Set the `--threshold-test` option to a Student's t-test (`t_test`).
    See [the `--threshold-test` docs][threshold test option] for a full overview.
    (ex: `--threshold-test t_test`)
    3. Set the `--threshold-max-sample-size` option to the maximum sample size of `64`.
    See [the `--threshold-max-sample-size` docs][threshold max sample size] for more details.
    (ex: `--threshold-max-sample-size 64`)
    4. Set the `--threshold-upper-boundary` option to the Upper Boundary of `0.99`.
    See [the `--threshold-upper-boundary` docs][threshold upper boundary] for more details.
    (ex: `--threshold-upper-boundary 0.99`)
    5. Set the `--thresholds-reset` flag so that only the specified Threshold is active.
    See [the `--thresholds-reset` docs][thresholds reset] for a full overview.
    (ex: `--thresholds-reset`)
13. Set the `--err` flag to fail the command if an Alert is generated.
   See [the `--err` docs][alert err] for a full overview.
   (ex: `--err`)
14. Set the `--adapter` option to [Bencher Metric Format JSON (`json`)][bmf] that is generated by <code><a href="/docs/reference/bencher-metric-format/#bencher-mock">bencher mock</a></code>.
   See [benchmark harness adapters][adapter json] for a full overview.
   (ex: `--adapter json`)
15. Set the `--github-actions` option to the GitHub API authentication token to post results as a GitHub Checks comment using
    [the GitHub Actions `GITHUB_TOKEN` environment variable][github token].
    See [the `--github-actions` docs][github actions option] for more details.
    (ex: `--github-actions '${{ secrets.GITHUB_TOKEN }}'`)
16. Specify the benchmark command arguments.
   See [benchmark command][command argument] for a full overview.
   (ex: `bencher mock`)

[github actions on]: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#on
[github actions push]: https://docs.github.com/en/webhooks/webhook-events-and-payloads#push
[github actions runs-on]: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idruns-on
[bencher cli github action]: https://github.com/marketplace/actions/bencher-cli
[github token]: https://docs.github.com/en/actions/security-guides/automatic-token-authentication

[statistical continuous benchmarking]: /docs/how-to/track-benchmarks/#statistical-continuous-benchmarking
[bencher run]: /docs/explanation/bencher-run/
[project option]: /docs/explanation/bencher-run/#--project-project
[token option]: /docs/explanation/bencher-run/#--token-token
[branch option]: /docs/explanation/branch-selection/#--branch-branch
[testbed option]: /docs/explanation/bencher-run/#--testbed-testbed
[threshold measure option]: /docs/explanation/thresholds/#--threshold-measure-measure
[threshold test option]: /docs/explanation/thresholds/#--threshold-test-test
[threshold max sample size]: /docs/explanation/thresholds/#--threshold-max-sample-size-size
[threshold upper boundary]: /docs/explanation/thresholds/#--threshold-upper-boundary-boundary
[thresholds reset]: /docs/explanation/thresholds/#--thresholds-reset
[alert err]: /docs/explanation/thresholds/#--err
[bmf]: /docs/reference/bencher-metric-format/
[adapter json]: /docs/explanation/adapters/#-json
[github actions option]: /docs/explanation/bencher-run/#--github-actions-github_token
[command argument]: /docs/explanation/bencher-run/#benchmark-command
