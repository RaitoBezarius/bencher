import PlayGameRsBenchPlayGame from "../play-game-rs-bench-play-game.mdx";

### ベンチマーク関数の作成

さて、FizzBuzzFibonacciゲームを実行するベンチマーク関数を作成しましょう：

<PlayGameRsBenchPlayGame />

一行ずつ確認していきます：
- `CustomBenchmark`で使用された署名に一致するベンチマーク関数を作成します。
- テストモードで`dhat::Profiler`を作成し、
  `dhat::Alloc`のカスタムグローバルアロケーターから結果を収集します。
- コンパイラがコードを最適化しないように、「ブラックボックス」内で`play_game`関数を実行します。
- `1`から`100`まで反復します（包含）。
- 各数値に対して、`print`を`false`に設定して`play_game`を呼び出します。
- ヒープ割り当て統計を`dhat::HeapStats`として返します。

> 🐰 `play_game`関数の`print`を`false`に設定しました。
> これにより、`play_game`が標準出力に出力しないようにします。
> このようにライブラリ関数をパラメーター化すると、
> ベンチマークを行いやすくなります。
> しかし、これはライブラリを実際に使用する際と
> 全く同じ方法でベンチマークを行わないことになります。
>
> この場合、自分たちに問う必要があります：
> 1. 標準出力に出力するためのリソースを気にする必要があるか？
> 2. 標準出力に出力することがノイズの原因となる可能性があるか？
>
> この例では、次のように決定しました：
> 1. いいえ、標準出力に出力することは気にしません。
> 2. はい、大変なノイズの原因となる可能性があります。
>
> したがって、このベンチマークの一部として標準出力への出力を省略しました。
> ベンチマークは難しく、このような質問に対する唯一の正解はありません。
> [状況次第です][changelog it depends].

[changelog it depends]: https://changelog.com/topic/itdepends