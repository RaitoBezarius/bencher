---
title: "Google Benchmark"
description: "逐步指南：如何使用 Google Benchmark 对 C++ 代码进行基准测试"
heading: "如何使用 Google Benchmark 对 C++ 代码进行基准测试"
published: "2024-11-03T16:30:00Z"
modified: "2024-11-03T16:30:00Z"
sortOrder: 1
---

import Benchmarking from "../../../chunks/benchmarking/zh/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/zh/fizz-buzz-rules.mdx";
import FizzBuzzCpp from "../../../chunks/benchmarking-cpp/zh/fizz-buzz-cpp.mdx";
import StepByStepCpp from "../../../chunks/benchmarking-cpp/zh/step-by-step-cpp.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/zh/micro-vs-macro.mdx";
import BenchmarkingCpp from "../../../chunks/benchmarking-cpp/zh/benchmarking-cpp.mdx";
import FizzBuzzRefactor from "../../../chunks/benchmarking-cpp/google-benchmark/zh/fizz-buzz-refactor.mdx";
import BenchmarkingFizzBuzz from "../../../chunks/benchmarking-cpp/google-benchmark/zh/benchmarking-fizz-buzz.mdx";
import FizzBuzzFibonacciCpp from "../../../chunks/benchmarking-cpp/zh/fizz-buzz-fibonacci-cpp.mdx";
import PlayGameCode from "../../../chunks/benchmarking-cpp/google-benchmark/play-game-code.mdx";
import BenchmarkingFizzBuzzFibonacci from "../../../chunks/benchmarking-cpp/google-benchmark/zh/benchmarking-fizz-buzz-fibonacci.mdx";
import FizzBuzzFibonacciOpenCpp from "../../../chunks/benchmarking-cpp/google-benchmark/zh/fizz-buzz-fibonacci-open-cpp.mdx";
import FizzBuzzFibonacciOpenCode from "../../../chunks/benchmarking-cpp/fizz-buzz-fibonacci-open-code.mdx";
import TheEnd from "../../../chunks/benchmarking/zh/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/zh/on-fire.mdx";
import TestGameOnFireCode from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-on-fire-code.mdx";
import BenchmarkGameOnFireOutputStart from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-on-fire-output-start.mdx";
import BenchmarkGameOnFireOutput from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-on-fire-output.mdx";
import FizzBuzzFibonacciFix from "../../../chunks/benchmarking-cpp/google-benchmark/zh/fizz-buzz-fibonacci-fix.mdx";
import BenchmarkGameFixOutput from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-fix-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/zh/catch-in-ci.mdx";
import CatchInCiOutput from "../../../chunks/benchmarking-cpp/google-benchmark/catch-in-ci-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/zh/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/benchmarking-rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/zh/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzCpp />

<StepByStepCpp />

<MicroVsMacro />

<BenchmarkingCpp />

两者都得到 [Bencher 的支持](/zh/docs/explanation/adapters/)。那么为什么选择 Google Benchmark？
Google Benchmark 无缝集成到 GoogleTest 中，而 GoogleTest 是 C++ 生态系统的事实标准单元测试框架。
我建议使用 Google Benchmark 来评估代码的延迟，特别是当你已经使用 GoogleTest 时。
也就是说，Google Benchmark 非常适合测量挂钟时间。

<FizzBuzzRefactor />

<BenchmarkingFizzBuzz />

<FizzBuzzFibonacciCpp>
  <PlayGameCode />
</FizzBuzzFibonacciCpp>

<BenchmarkingFizzBuzzFibonacci />

<FizzBuzzFibonacciOpenCpp>
    <FizzBuzzFibonacciOpenCode />
</FizzBuzzFibonacciOpenCpp>

<TheEnd />

<br />

<OnFire />

<TestGameOnFireCode />

- 微基准测试 `BENCHMARK_game_100` 用于玩数字一百（`100`）的游戏
- 微基准测试 `BENCHMARK_game_1_000_000` 用于玩数字一百万（`1_000_000`）的游戏

当我运行它时，我得到了这个结果：

<BenchmarkGameOnFireOutputStart />

等一下……再等一下……

<BenchmarkGameOnFireOutput />

什么！`1,249 ns` x `10,000` 应该是 `12,490,000 ns` 而不是 `110,879,642 ns` 🤯
尽管我的斐波那契序列代码功能上是正确的，但里面一定有性能问题。

<FizzBuzzFibonacciFix />

现在让我们重新运行这些基准测试，看看我们做得怎么样：

<BenchmarkGameFixOutput />

哦，哇！我们的 `BENCHMARK_game` 基准回到了原始 FizzBuzz 大概的位置。
如果我能记住那个得分是多少就好了，然而已经过去三周了。
我的终端历史记录没有那么长，而 Google Benchmark 也不存储它的结果。
不过我觉得差不多了！

`BENCHMARK_game_100` 基准测试几乎降低了 50 倍到 `34.4 ns`。
而 `BENCHMARK_game_1_000_000` 基准测试则降低了超过 1,500,000 倍！从 `110,879,642 ns` 到 `61.6 ns`！

> 🐰 至少我们在它上线前抓到了这个性能问题……哦，对了。算了……

<CatchInCi />

<CatchInCiOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="如何使用 Google Benchmark 对 C++ 进行基准测试" />

<BencherFooter />