---
title: "Google Benchmark"
description: "Google Benchmarkを使用してC++コードをベンチマークするためのステップバイステップガイド"
heading: "Google Benchmarkを使用してC++コードをベンチマークする方法"
published: "2024-11-03T16:30:00Z"
modified: "2024-11-03T16:30:00Z"
sortOrder: 1
---

import Benchmarking from "../../../chunks/benchmarking/ja/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/ja/fizz-buzz-rules.mdx";
import FizzBuzzCpp from "../../../chunks/benchmarking-cpp/ja/fizz-buzz-cpp.mdx";
import StepByStepCpp from "../../../chunks/benchmarking-cpp/ja/step-by-step-cpp.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/ja/micro-vs-macro.mdx";
import BenchmarkingCpp from "../../../chunks/benchmarking-cpp/ja/benchmarking-cpp.mdx";
import FizzBuzzRefactor from "../../../chunks/benchmarking-cpp/google-benchmark/ja/fizz-buzz-refactor.mdx";
import BenchmarkingFizzBuzz from "../../../chunks/benchmarking-cpp/google-benchmark/ja/benchmarking-fizz-buzz.mdx";
import FizzBuzzFibonacciCpp from "../../../chunks/benchmarking-cpp/ja/fizz-buzz-fibonacci-cpp.mdx";
import PlayGameCode from "../../../chunks/benchmarking-cpp/google-benchmark/play-game-code.mdx";
import BenchmarkingFizzBuzzFibonacci from "../../../chunks/benchmarking-cpp/google-benchmark/ja/benchmarking-fizz-buzz-fibonacci.mdx";
import FizzBuzzFibonacciOpenCpp from "../../../chunks/benchmarking-cpp/google-benchmark/ja/fizz-buzz-fibonacci-open-cpp.mdx";
import FizzBuzzFibonacciOpenCode from "../../../chunks/benchmarking-cpp/fizz-buzz-fibonacci-open-code.mdx";
import TheEnd from "../../../chunks/benchmarking/ja/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/ja/on-fire.mdx";
import TestGameOnFireCode from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-on-fire-code.mdx";
import BenchmarkGameOnFireOutputStart from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-on-fire-output-start.mdx";
import BenchmarkGameOnFireOutput from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-on-fire-output.mdx";
import FizzBuzzFibonacciFix from "../../../chunks/benchmarking-cpp/google-benchmark/ja/fizz-buzz-fibonacci-fix.mdx";
import BenchmarkGameFixOutput from "../../../chunks/benchmarking-cpp/google-benchmark/benchmark-game-fix-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/ja/catch-in-ci.mdx";
import CatchInCiOutput from "../../../chunks/benchmarking-cpp/google-benchmark/catch-in-ci-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/ja/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/benchmarking-rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/ja/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzCpp />

<StepByStepCpp />

<MicroVsMacro />

<BenchmarkingCpp />

両方とも[Bencherによってサポートされています](/ja/docs/explanation/adapters/)。
では、なぜGoogle Benchmarkを選ぶのか？
Google BenchmarkはGoogleTestとシームレスに統合され、
これはC++エコシステムで事実上の標準的なユニットテストハーネスです。
すでにGoogleTestを使用している場合、コードのレイテンシをベンチマークするにはGoogle Benchmarkを使用することをお勧めします。
つまり、Google Benchmarkは経過時間を計測するのに優れています。

<FizzBuzzRefactor />

<BenchmarkingFizzBuzz />

<FizzBuzzFibonacciCpp>
  <PlayGameCode />
</FizzBuzzFibonacciCpp>

<BenchmarkingFizzBuzzFibonacci />

<FizzBuzzFibonacciOpenCpp>
    <FizzBuzzFibonacciOpenCode />
</FizzBuzzFibonacciOpenCpp>

<TheEnd />

<br />

<OnFire />

<TestGameOnFireCode />

- 数字100（`100`）でゲームをプレイするためのマイクロベンチマーク`BENCHMARK_game_100`
- 数字1,000,000（`1_000_000`）でゲームをプレイするためのマイクロベンチマーク`BENCHMARK_game_1_000_000`

私が実行したとき、次のようになりました:

<BenchmarkGameOnFireOutputStart />

待ってください...待ってください...

<BenchmarkGameOnFireOutput />

なんと! `1,249 ns` x `10,000`は`12,490,000 ns`のはずなのに`110,879,642 ns` 🤯
フィボナッチ数列のコードは機能的に正しいはずですが、どこかにパフォーマンスの問題があります。

<FizzBuzzFibonacciFix />

それでは、もう一度これらのベンチマークを実行し、結果を見てみましょう:

<BenchmarkGameFixOutput />

おお、なんと！ `BENCHMARK_game`ベンチマークは元のFizzBuzzに戻ってきましたね。
そのスコアが正確にはどのくらいだったのか思い出せませんが。
3週間も前のことで、私のターミナル履歴はそんなに遡れず、Google Benchmarkは結果を保存しません。
でも、近いと思います！

`BENCHMARK_game_100`ベンチマークは約50倍に減少して`34.4 ns`です。
そして、`BENCHMARK_game_1_000_000`ベンチマークは1,500,000倍以上の削減！ `110,879,642 ns`から`61.6 ns`に！

> 🐰 まあ、少なくともこの性能問題をプロダクションに持ち込む前に見つけたのは良かったですね...あ、そうだね。冗談はさておき...

<CatchInCi />

<CatchInCiOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="Google Benchmarkを使用してC++をベンチマークする方法" />

<BencherFooter />