---
title: "pytest-benchmark"
description: "Um guia passo a passo sobre como fazer benchmark de c√≥digo Python com pytest-benchmark"
heading: "Como fazer benchmark de c√≥digo Python com pytest-benchmark"
published: "2024-10-09T16:30:00Z"
modified: "2024-10-09T16:30:00Z"
sortOrder: 1
---

import Benchmarking from "../../../chunks/benchmarking/pt/benchmarking.mdx";
import FizzBuzzRules from "../../../chunks/benchmarking/pt/fizz-buzz-rules.mdx";
import FizzBuzzPython from "../../../chunks/benchmarking-python/pt/fizz-buzz-python.mdx";
import StepByStepPython from "../../../chunks/benchmarking-python/pt/step-by-step-python.mdx";
import MicroVsMacro from "../../../chunks/benchmarking/pt/micro-vs-macro.mdx";
import BenchmarkingPython from "../../../chunks/benchmarking-python/pt/benchmarking-python.mdx";
import FizzBuzzRefactor from "../../../chunks/benchmarking-python/pytest-benchmark/pt/fizz-buzz-refactor.mdx";
import BenchmarkingFizzBuzz from "../../../chunks/benchmarking-python/pytest-benchmark/pt/benchmarking-fizz-buzz.mdx";
import FizzBuzzFibonacciPython from "../../../chunks/benchmarking-python/pt/fizz-buzz-fibonacci-python.mdx";
import PlayGameCode from "../../../chunks/benchmarking-python/pytest-benchmark/play-game-code.mdx";
import BenchmarkingFizzBuzzFibonacci from "../../../chunks/benchmarking-python/pytest-benchmark/pt/benchmarking-fizz-buzz-fibonacci.mdx";
import FizzBuzzFibonacciOpenPython from "../../../chunks/benchmarking-python/pt/fizz-buzz-fibonacci-open-python.mdx";
import FizzBuzzFibonacciOpenCode from "../../../chunks/benchmarking-python/fizz-buzz-fibonacci-open-code.mdx";
import TheEnd from "../../../chunks/benchmarking/pt/the-end.mdx";
import OnFire from "../../../chunks/benchmarking/pt/on-fire.mdx";
import TestGameOnFireCode from "../../../chunks/benchmarking-python/pytest-benchmark/test-game-on-fire-code.mdx";
import PytestGameOnFireOutputStart from "../../../chunks/benchmarking-python/pytest-benchmark/pytest-game-on-fire-output-start.mdx";
import PytestGameOnFireOutput from "../../../chunks/benchmarking-python/pytest-benchmark/pytest-game-on-fire-output.mdx";
import FizzBuzzFibonacciFix from "../../../chunks/benchmarking-python/pytest-benchmark/pt/fizz-buzz-fibonacci-fix.mdx";
import PytestGameFixOutput from "../../../chunks/benchmarking-python/pytest-benchmark/pytest-game-fix-output.mdx";
import CatchInCi from "../../../chunks/benchmarking/pt/catch-in-ci.mdx";
import CatchInCiOutput from "../../../chunks/benchmarking-python/pytest-benchmark/catch-in-ci-output.mdx";
import CatchInCiPlot from "../../../chunks/benchmarking/pt/catch-in-ci-plot.mdx";
import CatchInCiPlotRustBench from "../../../chunks/benchmarking-rust/catch-in-ci-plot-rust-bench.mdx";
import BencherFooter from "../../../chunks/learn/pt/bencher-footer.mdx";

<Benchmarking />

<FizzBuzzPython />

<StepByStepPython />

<MicroVsMacro />

<BenchmarkingPython />

Ambos s√£o [suportados pelo Bencher](/pt/docs/explanation/adapters/).
Ent√£o por que escolher `pytest-benchmark`?
`pytest-benchmark` integra-se perfeitamente com `pytest`,
que √© o padr√£o de fato para testes unit√°rios no ecossistema Python.
Recomendo usar `pytest-benchmark` para medir a lat√™ncia do seu c√≥digo,
especialmente se voc√™ j√° estiver utilizando `pytest`.
Ou seja, `pytest-benchmark` √© √≥timo para medir o tempo de rel√≥gio de parede.

<FizzBuzzRefactor />

<BenchmarkingFizzBuzz />

<FizzBuzzFibonacciPython>
  <PlayGameCode />
</FizzBuzzFibonacciPython>

<BenchmarkingFizzBuzzFibonacci />

<FizzBuzzFibonacciOpenPython>
    <FizzBuzzFibonacciOpenCode />
</FizzBuzzFibonacciOpenPython>

<TheEnd />

<br />

<OnFire />

<TestGameOnFireCode />

- Um microbenchmark `test_game_100` para jogar o jogo com o n√∫mero cem (`100`)
- Um microbenchmark `test_game_1_000_000` para jogar o jogo com o n√∫mero um milh√£o (`1_000_000`)

Quando executei, obtive o seguinte resultado:

<PytestGameOnFireOutputStart />

Espere por isso... espere por isso...

<PytestGameOnFireOutput />

O qu√™! `15.8470 us` x `1.000` deveria ser `15.847.0 us` e n√£o `571.684.6334 us` ü§Ø
Mesmo que eu tenha acertado minha fun√ß√£o de sequ√™ncia de Fibonacci, devo ter algum bug de desempenho em algum lugar.

<FizzBuzzFibonacciFix />

Agora vamos executar esses benchmarks novamente e ver como nos sa√≠mos:

<PytestGameFixOutput />

Uau! Nosso benchmark `test_game` est√° de volta a algo pr√≥ximo do original FizzBuzz.
Gostaria de lembrar exatamente qual era essa pontua√ß√£o. J√° faz tr√™s semanas.
Meu hist√≥rico do terminal n√£o vai t√£o longe.
E o `pytest-benchmark` s√≥ armazena seus resultados quando pedimos.
Mas acho que est√° perto!

O benchmark `test_game_100` caiu quase 50x para `322.0815 ns`.
E o benchmark `test_game_1_000_000` caiu mais de 500.000x! De `571.684.633,4 ns` para `753.1445 ns`!

> üê∞ Pelo menos pegamos esse bug de desempenho antes que chegasse √† produ√ß√£o... ah, certo. Deixa pra l√°...

<CatchInCi />

<CatchInCiOutput />

<CatchInCiPlot />

<CatchInCiPlotRustBench title="Como mensurar desempenho em Rust com pytest-benchmark" />

<BencherFooter />